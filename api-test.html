<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #005a9f;
        }
        .result {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .warning { border-left: 4px solid #ffc107; }
    </style>
</head>
<body>
    <h1>ğŸ”§ APIè°ƒè¯•å·¥å…·</h1>
    <p>ç”¨äºæµ‹è¯•æ•…äº‹ç”Ÿæˆå’Œå›¾ç‰‡ç”ŸæˆAPIçš„è¿æ¥çŠ¶æ€</p>

    <div class="test-section">
        <h2>ğŸ“š æ•…äº‹ç”ŸæˆAPIæµ‹è¯•</h2>
        <p>æµ‹è¯•ç«å±±å¼•æ“APIè¿æ¥</p>
        <button class="test-button" onclick="testStoryAPI()">æµ‹è¯•æ•…äº‹API</button>
        <div id="storyResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ¨ å›¾ç‰‡ç”ŸæˆAPIæµ‹è¯•</h2>
        <p>æµ‹è¯•é˜¿é‡Œäº‘æ–‡ç”Ÿå›¾APIè¿æ¥</p>
        <button class="test-button" onclick="testImageAPI()">æµ‹è¯•å›¾ç‰‡API</button>
        <button class="test-button" onclick="testCORSProxy()">æµ‹è¯•CORSä»£ç†</button>
        <div id="imageResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•</h2>
        <p>æ£€æŸ¥åŸºæœ¬ç½‘ç»œè¿æ¥å’Œè·¨åŸŸè®¾ç½®</p>
        <button class="test-button" onclick="testNetworkConnection()">æµ‹è¯•ç½‘ç»œè¿æ¥</button>
        <div id="networkResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ’¡ å»ºè®®çš„è§£å†³æ–¹æ¡ˆ</h2>
        <div class="result warning">
            <strong>é’ˆå¯¹å›¾ç‰‡ç”Ÿæˆå¤±è´¥çš„è§£å†³æ–¹æ¡ˆï¼š</strong>
            
            1. <strong>ä½¿ç”¨CORSä»£ç†</strong>
               - éƒ¨ç½²åˆ°æ”¯æŒæœåŠ¡ç«¯ä»£ç†çš„å¹³å°
               - ä½¿ç”¨Netlify Functionsæˆ–Vercel Functions
            
            2. <strong>æ›¿ä»£APIæœåŠ¡</strong>
               - ä½¿ç”¨æ”¯æŒCORSçš„å›¾ç‰‡ç”ŸæˆæœåŠ¡
               - é›†æˆå…è´¹çš„å›¾ç‰‡APIï¼ˆå¦‚Unsplashã€Pixabayï¼‰
            
            3. <strong>æœ¬åœ°å›¾ç‰‡åº“</strong>
               - å‡†å¤‡ä¸€å¥—å„¿ç«¥å‹å¥½çš„æ’å›¾ç´ æ
               - æ ¹æ®å…³é”®è¯æ™ºèƒ½åŒ¹é…å›¾ç‰‡
            
            4. <strong>æ”¹è¿›çš„å ä½å›¾</strong>
               - ä½¿ç”¨CSSå’ŒSVGåˆ›å»ºæ›´ç¾è§‚çš„å ä½å›¾
               - æ·»åŠ åŠ¨ç”»æ•ˆæœå¢å¼ºè§†è§‰ä½“éªŒ
        </div>
    </div>

    <script>
        // é…ç½®ä¿¡æ¯ï¼ˆè¯·æ›¿æ¢ä¸ºå®é™…å€¼ï¼‰
        const API_CONFIG = {
            volcano: {
                url: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
                key: '893b9f2c-3b3c-4943-a482-5ab6dde65007',
                model: 'deepseek-r1-250528'
            },
            aliyun: {
                key: 'sk-b4e340d0f9d44156b1086eed3630a2e0',
                url: 'https://dashscope.aliyuncs.com/api/v1/services/aigc/text2image/image-synthesis'
            }
        };

        // æµ‹è¯•æ•…äº‹ç”ŸæˆAPI
        async function testStoryAPI() {
            const resultDiv = document.getElementById('storyResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•æ•…äº‹API...';
            resultDiv.className = 'result';

            try {
                const response = await fetch(API_CONFIG.volcano.url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_CONFIG.volcano.key}`
                    },
                    body: JSON.stringify({
                        model: API_CONFIG.volcano.model,
                        messages: [
                            { role: "system", content: "ä½ æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹." },
                            { role: "user", content: "è¯·ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå·±" }
                        ],
                        max_tokens: 100
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `âœ… æ•…äº‹APIè¿æ¥æˆåŠŸï¼\nå“åº”: ${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = 'result success';
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `âŒ æ•…äº‹APIè¯·æ±‚å¤±è´¥\nçŠ¶æ€ç : ${response.status}\né”™è¯¯ä¿¡æ¯: ${errorText}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ æ•…äº‹APIè¿æ¥å¤±è´¥\né”™è¯¯ä¿¡æ¯: ${error.message}\nå¯èƒ½åŸå› : ç½‘ç»œé—®é¢˜æˆ–CORSé™åˆ¶`;
                resultDiv.className = 'result error';
            }
        }

        // æµ‹è¯•å›¾ç‰‡ç”ŸæˆAPI
        async function testImageAPI() {
            const resultDiv = document.getElementById('imageResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•å›¾ç‰‡API...';
            resultDiv.className = 'result';

            try {
                const response = await fetch(API_CONFIG.aliyun.url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_CONFIG.aliyun.key}`
                    },
                    body: JSON.stringify({
                        model: 'wanx-v1',
                        input: {
                            prompt: 'cute cartoon cat in a garden',
                            size: '512*512'
                        }
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `âœ… å›¾ç‰‡APIè¿æ¥æˆåŠŸï¼\nå“åº”: ${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = 'result success';
                } else {
                    const errorText = await response.text();
                    resultDiv.innerHTML = `âŒ å›¾ç‰‡APIè¯·æ±‚å¤±è´¥\nçŠ¶æ€ç : ${response.status}\né”™è¯¯ä¿¡æ¯: ${errorText}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ å›¾ç‰‡APIè¿æ¥å¤±è´¥\né”™è¯¯ä¿¡æ¯: ${error.message}\nå¯èƒ½åŸå› : CORSé™åˆ¶æˆ–APIé…ç½®é—®é¢˜`;
                resultDiv.className = 'result error';
            }
        }

        // æµ‹è¯•CORSä»£ç†
        async function testCORSProxy() {
            const resultDiv = document.getElementById('imageResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•CORSä»£ç†æ–¹æ¡ˆ...';
            resultDiv.className = 'result';

            // æµ‹è¯•ä¸€äº›å…¬å¼€çš„CORSä»£ç†æœåŠ¡
            const proxyUrls = [
                'https://cors-anywhere.herokuapp.com/',
                'https://api.allorigins.win/raw?url=',
                'https://api.codetabs.com/v1/proxy?quest='
            ];

            for (const proxy of proxyUrls) {
                try {
                    const testUrl = `${proxy}${encodeURIComponent('https://httpbin.org/json')}`;
                    const response = await fetch(testUrl);
                    
                    if (response.ok) {
                        resultDiv.innerHTML = `âœ… æ‰¾åˆ°å¯ç”¨çš„CORSä»£ç†: ${proxy}\nå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ­¤ä»£ç†`;
                        resultDiv.className = 'result success';
                        return;
                    }
                } catch (error) {
                    console.log(`ä»£ç† ${proxy} ä¸å¯ç”¨:`, error);
                }
            }

            resultDiv.innerHTML = `âš ï¸ æœªæ‰¾åˆ°å¯ç”¨çš„å…¬å…±CORSä»£ç†\nå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰ä»£ç†æœåŠ¡æˆ–æœåŠ¡ç«¯API`;
            resultDiv.className = 'result warning';
        }

        // æµ‹è¯•ç½‘ç»œè¿æ¥
        async function testNetworkConnection() {
            const resultDiv = document.getElementById('networkResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•ç½‘ç»œè¿æ¥...';
            resultDiv.className = 'result';

            const tests = [
                { name: 'åŸºæœ¬ç½‘ç»œè¿æ¥', url: 'https://httpbin.org/json' },
                { name: 'ç«å±±å¼•æ“å¯è¾¾æ€§', url: 'https://ark.cn-beijing.volces.com' },
                { name: 'é˜¿é‡Œäº‘å¯è¾¾æ€§', url: 'https://dashscope.aliyuncs.com' }
            ];

            let results = [];

            for (const test of tests) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(test.url, { method: 'HEAD', mode: 'no-cors' });
                    const endTime = Date.now();
                    results.push(`âœ… ${test.name}: å¯è¾¾ (${endTime - startTime}ms)`);
                } catch (error) {
                    results.push(`âŒ ${test.name}: ä¸å¯è¾¾ - ${error.message}`);
                }
            }

            resultDiv.innerHTML = results.join('\n');
            resultDiv.className = 'result';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•åŸºç¡€è¿æ¥
        window.addEventListener('load', () => {
            testNetworkConnection();
        });
    </script>
</body>
</html>